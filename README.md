### OTUS-Linux-2023-10-L33 | OSPF

В репозитории Vagrantfile с необходимым окружением. При запуске стартуют 3 маршрутизатора между которыми поднимается соседство по протоколу OSPF.  
По-умолчанию, маршруты до противоположных от каждого маршрутизатора сетей являются эквивалентными и происходт балансиоровка трафика междву двумя next-hop'ами.  
Также, маршруты до LAN-сетей соседов происходт напряму через них.  
Например для router1:  

		router1# sh ip route
		....
		O  10.0.10.0/30 [110/100] is directly connected, eth1, weight 1, 00:10:00
		O> 10.0.11.0/30 [110/200] via 10.0.10.2, eth1, weight 1, 00:06:35
		                          via 10.0.12.2, eth2, weight 1, 00:06:35
		O   10.0.12.0/30 [110/100] is directly connected, eth2, weight 1, 00:10:00
		O   192.168.10.0/24 [110/100] is directly connected, eth3, weight 1, 00:10:00
		O> 192.168.20.0/24 [110/200] via 10.0.10.2, eth1, weight 1, 00:08:10
		O> 192.168.30.0/24 [110/200] via 10.0.12.2, eth2, weight 1, 00:06:35

Для того чтобы сделать маршрутизацию ассиметричной, достаточно у одного маршрутизатор увеличить (от текущего) cost любого интерфейса.  
Например, если для интерфейса eth1 маршрутизатора router1 увеличить cost до 1000 (команда на интерфейсе: ***ip ospf cost 1000***), то мы получим маршруты только с одним nexthop'ом, второй (через 10.0.10.2) будет дороже и станет резервным с точки зрения router1.  

		router1# sh ip route ospf 
		....
		O   10.0.10.0/30 [110/1000] is directly connected, eth1, weight 1, 00:02:27
		O> 10.0.11.0/30 [110/200] via 10.0.12.2, eth2, weight 1, 00:24:09
		O   10.0.12.0/30 [110/100] is directly connected, eth2, weight 1, 00:49:52
		O   192.168.10.0/24 [110/100] is directly connected, eth3, weight 1, 00:49:52
		O> 192.168.20.0/24 [110/300] via 10.0.12.2, eth2, weight 1, 00:24:09
		O> 192.168.30.0/24 [110/200] via 10.0.12.2, eth2, weight 1, 00:46:27
  

С точки зрения других маршрутизаторов ничего не измениться, там также останется балансировка и прямые маршруты к сетям соседей.  

Для того чтобы не было балансировки и чтобы для всех маршрутизаторов использовался один путь - необходимо увеличть cost на интерфейсах двух соседей (команда та же).  
Тогда стоимость линка между двумя маршрутизаторами будет "дороже" для обоих маршрутизаторов и будут установлены маршруты только через один путь, второй останется в резерве.  

		router2# sh ip route ospf 
		....
		O   10.0.10.0/30 [110/1000] is directly connected, eth1, weight 1, 00:01:19
		O   10.0.11.0/30 [110/100] is directly connected, eth2, weight 1, 00:47:09
		O> 10.0.12.0/30 [110/200] via 10.0.11.1, eth2, weight 1, 00:01:19
		O> 192.168.10.0/24 [110/300] via 10.0.11.1, eth2, weight 1, 00:01:19
		O   192.168.20.0/24 [110/100] is directly connected, eth3, weight 1, 00:47:09
		O> 192.168.30.0/24 [110/200] via 10.0.11.1, eth2, weight 1, 00:45:25

P.S. из конфигов FRR убрал ненужные команды из методички (mtu-ignore, hello-interval, dead-interval) они используюся в определённых случаях при тонкой настроке и для данного стэнда совершенно не нужны.





